sap.ui.define(["sap/ui/mdc/base/ConditionModel"],function(C){"use strict";function a(M,i,l,t,o,b){var c=b.getMetaModel(),d=c.requestObject(M);return d.then(function(){var I=t.getInnerTable(),p=c.createBindingContext(M),T=o.getProperty(t,"type"),f,v;if(T==='ResponsiveTable'){f="sap.ui.mdc.internal.table.responsivetable.AddColumnChange";}else if(T==='GridTable'){f="sap.ui.mdc.internal.table.gridtable.AddGridTableColumnChange";}try{var v=sap.ui.view({viewContent:'<core:View xmlns:core="sap.ui.core"><core:Fragment fragmentName="'+f+'" type="XML"/></core:View>',type:"XML",async:true,preprocessors:{xml:{bindingContexts:{dataField:p},models:{dataField:c}}}});}catch(e){jQuery.sap.log.error(e);}return v.loaded().then(function(){var g=v.getContent()[0].getColumns()[0],h,L,j,k,n,q;g.sId=t.getId()+'--'+g.getId().split('--')[1];if(l){if(T==='ResponsiveTable'){j=g.getHeader();}else if(T==='GridTable'){var j=g.getLabel();}j.setText(l);}o.insertAggregation(I,"columns",g,i);if(T==='ResponsiveTable'){h=v.getContent()[1];L=o.getBindingTemplate(I,"items");o.insertAggregation(L,"cells",h,i);}n=t.getListBinding();q=C.getFor(n);k=t.getListBindingInfo();n.getModel().unregisterNamedBinding(n);t.getInnerTable().bindItems({path:k.path,template:k.template,parameters:k.parameters});if(q){q.setFor(t.getListBinding());q.applyFilters();}return g;});});}function r(e,t,M){var I=t.getInnerTable(),T=M.getProperty(t,"type"),l,b=M.getAggregation(I,"columns"),d,R={},o,f,g;for(var i=0;i<b.length;i++){if(M.getId(b[i])===e){f=b[i];g=M.getAggregation(f,"customData");for(var c=0;c<g.length;c++){if(M.getProperty(g[c],"key")==="metaContextPath"){R.metaContextPath=M.getProperty(g[c],"value");}}R.index=i;if(T==='ResponsiveTable'){o=M.getAggregation(f,"header");}else if(T==='GridTable'){o=M.getAggregation(f,"label");}R.label=M.getProperty(o,"text");M.removeAggregation(I,"columns",f);if(T==='ResponsiveTable'){l=M.getBindingTemplate(I,"items");d=M.getAggregation(l,"cells");M.removeAggregation(l,"cells",d[i]);}return R;}}}function m(e,t,T,M){var I=T.getInnerTable(),c=M.getAggregation(I,"columns"),s=M.getProperty(T,"type"),l,b;for(var i=0;i<c.length;i++){if(M.getId(c[i])===e){M.removeAggregation(I,"columns",c[i]);M.insertAggregation(I,"columns",c[i],t);if(s==='ResponsiveTable'){l=M.getBindingTemplate(I,"items");b=M.getAggregation(l,"cells");M.removeAggregation(l,"cells",b[i]);M.insertAggregation(l,"cells",b[i],t);}}}}return{"addColumn":{applyChange:function(c,t,p){var o=c.getDefinition(),M=o.content.bindingString,l=o.content.label,i=o.content.index,b=p.modifier,d=p.appComponent||p.view,e=d?d.getModel():undefined;if(!e instanceof sap.ui.model.odata.v4.ODataModel){jQuery.sap.log.error("Change can't be applied without a container having a Odata v4 model assigned");return false;}return a(M,i,l,t,b,e).then(function(f){c.setRevertData({elementId:b.getId(f)});});},revertChange:function(c,t,p){var R=c.getRevertData();if(R){r(R.elementId,t,p.modifier);c.resetRevertData();}else{jQuery.sap.log.error("Attempt to revert an unapplied change.");return false;}return true;}},"moveColumns":{applyChange:function(c,t,p){var o=c.getDefinition(),M=o.content.movedElements;for(var x=0;x<M.length;x++){m(M[x].element,M[x].targetIndex,t,p.modifier);}return true;},revertChange:function(c,t,p){var o=c.getDefinition(),M=o.content.movedElements;for(var x=0;x<M.length;x++){m(M[x].element,M[x].sourceIndex,t,p.modifier);}return true;}},"removeColumn":{applyChange:function(c,t,p){var o=c.getDefinition(),R;R=r(o.content.removedElement,t,p.modifier);c.setRevertData(R);return true;},revertChange:function(c,t,p){var R=c.getRevertData(),M=p.appComponent||p.view,o=M?M.getModel():undefined;if(R){return a(R.metaContextPath,R.index,R.label,t,p.modifier,o).then(function(){c.resetRevertData();});}else{jQuery.sap.log.error("Attempt to revert an unapplied change.");return false;}}},"setTableType":{applyChange:function(c,t,p){var o=c.getDefinition(),s=t.getType(),M=p.modifier;M.setProperty(t,"type",o.content.tableType);c.setRevertData({originalTableType:s});return true;},revertChange:function(c,t,p){var R=c.getRevertData(),M=p.modifier;if(R){M.setProperty(t,"type",R.originalTableType);}else{jQuery.sap.log.error("Attempt to revert an unapplied change.");return false;}}}};},false);
