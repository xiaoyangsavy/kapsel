/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/mdc/experimental/FieldHelpBase','sap/ui/model/base/ManagedObjectModel','sap/ui/base/ManagedObjectObserver','sap/m/List','sap/m/DisplayListItem'],function(F,M,a,L,D){"use strict";var T=F.extend("sap.ui.mdc.experimental.TableFieldHelp",{metadata:{library:"sap.ui.mdc",properties:{keyColumn:{type:"int",group:"Data",defaultValue:0},valueColumn:{type:"int",group:"Data",defaultValue:0}},aggregations:{table:{type:"sap.m.Table",multiple:false}},defaultAggregation:"table",events:{}}});T.prototype.init=function(){F.prototype.init.apply(this,arguments);this._oObserver=new a(_.bind(this));this._oObserver.observe(this,{properties:["selectedKey","filterValue"],aggregations:["table"]});};T.prototype.exit=function(){F.prototype.exit.apply(this,arguments);this._oObserver.disconnect();this._oObserver=undefined;};T.prototype._createPopover=function(){var p=F.prototype._createPopover.apply(this,arguments);var P=this.getParent();if(P){p.setInitialFocus(P);}p.getContent=function(){var P=this.getParent();if(P){return[P.getTable()];}return[];};return p;};T.prototype.setParent=function(p,A,s){F.prototype.setParent.apply(this,arguments);var P=this.getAggregation("_popover");if(P){P.setInitialFocus(p);}return this;};function _(C){if(C.name=="table"){this.fireDataUpdate();var t=C.child;var p=this.getAggregation("_popover");if(C.mutation=="remove"){t.detachEvent("selectionChange",b,this);t.detachEvent("updateFinished",d,this);}else{t.setMode(sap.m.ListMode.SingleSelectMaster);t.setRememberSelections(false);t.attachEvent("selectionChange",b,this);t.attachEvent("updateFinished",d,this);e.call(this,this.getSelectedKey());}if(p){p.invalidate();}}if(C.name=="selectedKey"){e.call(this,C.current);}if(C.name=="filterValue"){}}T.prototype.openByTyping=function(){return true;};T.prototype.navigate=function(s){var t=this.getTable();var p=this._getPopover();var S=t.getSelectedItem();var i=t.getItems();var I=i.length;var f=0;if(S){f=t.indexOfItem(S);f=f+s;if(f<0){f=0;}else if(f>=I-1){f=I-1;}}else if(s>=0){f=s-1;}else{f=I+s;}var o=i[f];if(o){o.setSelected(true);var k=c.call(this,o);this.setProperty("selectedKey",k.key,true);if(!p.isOpen()){this.open();}this.fireNavigate({value:k.value,additionalValue:k.additionalValue,key:k.key});}};T.prototype.getTextForKey=function(k){var K=this.getKeyColumn();var v=this.getValueColumn();var t=this.getTable();if(t){var I=t.getItems();for(var i=0;i<I.length;i++){var o=I[i];if(o.getCells){var C=o.getCells();var f=C[K];var V=C[v];var s;if(f.getText){s=f.getText();}if(k==s){if(V.getText){return V.getText();}else{return"";}}}}}return"";};T.prototype.getKeyForText=function(t){var k=this.getKeyColumn();var v=this.getValueColumn();var o=this.getTable();if(o){var I=o.getItems();for(var i=0;i<I.length;i++){var f=I[i];if(f.getCells){var C=f.getCells();var K=C[k];var V=C[v];var s;if(V.getText){s=V.getText();}if(s==t){if(K.getText){return K.getText();}else{return"";}}}}}return"";};function b(E){var i=E.getParameter("listItem");var s=E.getParameter("selected");if(s){var k=c.call(this,i);this.setProperty("selectedKey",k.key,true);this.close();this.fireSelect({value:k.value,additionalValue:k.additionalValue,key:k.key});}}function c(i){var k=this.getKeyColumn();var v=this.getValueColumn();var K;var V;var A;if(i.getCells){var C=i.getCells();var o=C[k];var f=C[v];if(o.getText){K=o.getText();}if(f.getText){V=f.getText();}}return{key:K,value:V,additionalValue:A};}function d(){e.call(this,this.getSelectedKey());this.fireDataUpdate();}function e(s){var t=this.getTable();if(t){var I=t.getItems();for(var i=0;i<I.length;i++){var o=I[i];var k=c.call(this,o);if(k.key==s){o.setSelected(true);}else{o.setSelected(false);}}}}return T;},true);
