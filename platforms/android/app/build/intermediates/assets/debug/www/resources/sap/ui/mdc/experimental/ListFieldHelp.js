/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/mdc/experimental/FieldHelpBase','sap/ui/model/base/ManagedObjectModel','sap/ui/base/ManagedObjectObserver','sap/m/List','sap/m/DisplayListItem'],function(F,M,a,L,D){"use strict";var b=F.extend("sap.ui.mdc.experimental.ListFieldHelp",{metadata:{library:"sap.ui.mdc",properties:{},aggregations:{items:{type:"sap.ui.core.ListItem",multiple:true,singularName:"item"}},defaultAggregation:"items",events:{}}});b.prototype.init=function(){F.prototype.init.apply(this,arguments);this._oManagedObjectModel=new M(this);this._oObserver=new a(_.bind(this));this._oObserver.observe(this,{properties:["selectedKey","filterValue"],aggregations:["items"]});};b.prototype.exit=function(){F.prototype.exit.apply(this,arguments);this._oManagedObjectModel.destroy();delete this._oManagedObjectModel;this._oObserver.disconnect();this._oObserver=undefined;};b.prototype._createPopover=function(){var p=F.prototype._createPopover.apply(this,arguments);var P=this.getParent();if(P){p.setInitialFocus(P);}var i=new D({label:"{$field>text}",value:"{$field>additionalText}"});var o=new sap.ui.model.Filter("text",e.bind(this));this._oList=new L(this.getId()+"-List",{width:"100%",showNoData:false,mode:sap.m.ListMode.SingleSelectMaster,rememberSelections:false,items:{path:"$field>items",template:i,filters:o},selectionChange:c.bind(this)});this._oList.setModel(this._oManagedObjectModel,"$field");this._oList.bindElement({path:"/",model:"$field"});f.call(this,this.getSelectedKey());this._setContent(this._oList);return p;};b.prototype.setParent=function(p,A,s){F.prototype.setParent.apply(this,arguments);var P=this.getAggregation("_popover");if(P){P.setInitialFocus(p);}return this;};function _(C){if(C.name=="items"){this.fireDataUpdate();}if(C.name=="selectedKey"){f.call(this,C.current);}if(C.name=="filterValue"){if(this._oList){var B=this._oList.getBinding("items");B.update();this._oList.updateItems();this._oList.invalidate();f.call(this,this.getSelectedKey());}}}b.prototype.openByTyping=function(){return true;};b.prototype.navigate=function(s){var p=this._getPopover();var S=this._oList.getSelectedItem();var i=this._oList.getItems();var I=i.length;var g=0;if(S){g=this._oList.indexOfItem(S);g=g+s;if(g<0){g=0;}else if(g>=I-1){g=I-1;}}else if(s>=0){g=s-1;}else{g=I+s;}var o=i[g];if(o){var O=d.call(this,o);o.setSelected(true);this.setProperty("selectedKey",O.getKey(),true);if(!p.isOpen()){this.open();}this.fireNavigate({value:o.getLabel(),additionalValue:o.getValue(),key:O.getKey()});}};b.prototype.getTextForKey=function(k){var I=this.getItems();for(var i=0;i<I.length;i++){var o=I[i];if(o.getKey()==k){return o.getText();}}return"";};b.prototype.getKeyForText=function(t){var I=this.getItems();for(var i=0;i<I.length;i++){var o=I[i];if(o.getText()==t){return o.getKey();}}return"";};function c(E){var i=E.getParameter("listItem");var s=E.getParameter("selected");if(s){var o=d.call(this,i);this.setProperty("selectedKey",o.getKey(),true);this.close();this.fireSelect({value:i.getLabel(),additionalValue:i.getValue(),key:o.getKey()});}}function d(i){var p=i.getBindingContextPath();return this._oManagedObjectModel.getProperty(p);}function e(t){var s=this.getFilterValue();if(!s||jQuery.sap.startsWithIgnoreCase(t,s)){return true;}else{return false;}}function f(s){if(this._oList){var I=this._oList.getItems();for(var i=0;i<I.length;i++){var o=I[i];var O=d.call(this,o);if(O.getKey()==s){o.setSelected(true);}else{o.setSelected(false);}}}}return b;},true);
