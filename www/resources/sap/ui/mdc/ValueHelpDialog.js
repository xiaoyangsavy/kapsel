/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(["./library",'sap/ui/mdc/base/ValueHelpDialog',"sap/ui/model/json/JSONModel"],function(L,b,J){"use strict";var V=b.extend("sap.ui.mdc.ValueHelpDialog",{metadata:{properties:{entitySet:"string",fieldPath:"string"},aggregations:{},events:{},publicMethods:[]},fragment:"sap.ui.mdc.base.ValueHelpDialog"});V.prototype.init=function(){this.attachModelContextChange(c);};var c=function(){var t=this;this.detachModelContextChange(c);this._requestValueListMetadata(this.getEntitySet(),this.getFieldPath()).then(function(v){var o=new J(v);var a=sap.ui.view({viewName:"sap.ui.mdc.internal.valuehelp.ValueHelp",type:"XML",height:"100%",async:true,preprocessors:{xml:{bindingContexts:{valueList:o.createBindingContext("/")},models:{valueList:o}}}});var C=t.getConditionModel();var d=C.clone(t.getFieldPath());a.setModel(d,"cm");a.setBindingContext(d.createBindingContext("/"),"cm");a.setModel(o,"valueList");a.setModel(v.$model);return a.loaded().then(function(a){t.setTitle(a.getModel("valueList").getProperty("/sTitle"));a.getController().sFieldPath=t.getFieldPath();var T=a.byId("valueListTable");var n=T.getColumns().length;var e=Math.max(1080,n*130);t.get_content().setContentWidth(e+"px");t.addContent(a);});});};V.prototype._requestValueListMetadata=function(e,f){var m=this.getModel().getMetaModel();return m.requestValueListInfo('/'+e+'/'+f).then(function(v){var p;if(v[""]){p=v[""].Parameters;var l=m.getObject('/'+e+'/'+f+"@sapui.name");var F=m.getObject("/"+e+"@com.sap.vocabularies.Common.v1.FilterExpressionRestrictions");var o=F&&F.filter(function(a){return a.Property.$PropertyPath===f;});v[""].sTitle=m.getObject("/"+e+"/$Type/"+f+"@com.sap.vocabularies.Common.v1.Label");if(o&&(o.length>0)&&(o[0].AllowedExpressions.$EnumMember.indexOf("SingleValue")>-1)){v[""].sSelectionMode="SingleSelectLeft";v[""].sTitle=L.getText("valuehelp.SINGLE_ITEM_SELECT")+v[""].sTitle;}else{v[""].sSelectionMode="MultiSelect";}for(var i=0;i<p.length;i++){if(p[i].LocalDataProperty&&p[i].LocalDataProperty.$PropertyPath===l){v[""].__sapfe={keyPath:p[i].ValueListProperty,descriptionPath:v[""].$model.getMetaModel().getObject("/"+v[""].CollectionPath+"/"+p[i].ValueListProperty+"@com.sap.vocabularies.Common.v1.Text/$Path")};break;}}return v[""];}else{throw("no unqualified value list found - currently qualified value lists are not considered");}},function(E){throw(E.message);});};return V;},true);
