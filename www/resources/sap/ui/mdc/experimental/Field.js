/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/core/Control','sap/ui/model/base/ManagedObjectModel','sap/ui/base/ManagedObjectObserver','sap/ui/model/BindingMode','sap/m/Input','sap/m/Text','sap/m/Link','sap/m/TextArea','sap/ui/mdc/library'],function(q,C,M,a,B,I,T,L,b,l){"use strict";var D;var c;var d;var E=l.EditMode;var F=l.FieldDisplay;var e=C.extend("sap.ui.mdc.experimental.Field",{metadata:{interfaces:["sap.ui.core.IFormContent"],library:"sap.ui.mdc",properties:{value:{type:"any",defaultValue:null},additionalValue:{type:"any",defaultValue:null},dataType:{type:"string",group:"Data",defaultValue:'sap.ui.model.type.String'},dataTypeConstraints:{type:"object",group:"Data",defaultValue:null},dataTypeFormatOptions:{type:"object",group:"Data",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:""},editMode:{type:"sap.ui.mdc.EditMode",group:"Data",defaultValue:E.Editable},required:{type:"boolean",group:"Data",defaultValue:false},icon:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:null},display:{type:"sap.ui.mdc.FieldDisplay",defaultValue:F.Value},textAlign:{type:"sap.ui.core.TextAlign",group:"Appearance",defaultValue:sap.ui.core.TextAlign.Initial},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:sap.ui.core.TextDirection.Inherit},placeholder:{type:"string",group:"Misc",defaultValue:null},valueState:{type:"sap.ui.core.ValueState",group:"Appearance",defaultValue:sap.ui.core.ValueState.None},valueStateText:{type:"string",group:"Misc",defaultValue:null},multipleLines:{type:"boolean",group:"Appearance",defaultValue:false}},aggregations:{content:{type:"sap.ui.core.Control",multiple:false},_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},fieldHelp:{type:"sap.ui.mdc.experimental.FieldHelpBase",multiple:false},displayFieldHelp:{type:"sap.ui.mdc.experimental.FieldHelpBase",multiple:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{change:{parameters:{value:{type:"string"},valid:{type:"boolean"}}},liveChange:{parameters:{value:{type:"string"},escPressed:{type:"boolean"},previousValue:{type:"string"}}},dataChanged:{},press:{}},publicMethods:[],defaultAggregation:"content",defaultProperty:"value"},_oManagedObjectModel:null});e.prototype.init=function(){this._oManagedObjectModel=new M(this);this._oObserver=new a(i.bind(this));this._oObserver.observe(this,{properties:["value","additionalValue","display","editMode","dataType","multipleLines"],aggregations:["fieldHelp","displayFieldHelp","content"]});};e.prototype.exit=function(){this._oManagedObjectModel.destroy();delete this._oManagedObjectModel;this._oObserver.disconnect();this._oObserver=undefined;};e.prototype.onBeforeRendering=function(){f.call(this);};e.prototype.onAfterRendering=function(){if(this.getFieldHelp()&&this.getEditMode()!=E.Display){var H=this.getAggregation("_content");if(H){var J=H.getFocusDomRef();q(J).attr("autocomplete","off");}}};function _(K){if(!this.isBound("additionalValue")){var H=this.getFieldHelp();if(H&&this.getDisplay()==sap.ui.mdc.FieldDisplay.Description){var J;if(K){J=H.getTextForKey(K);H.setSelectedKey(K);}this.setAdditionalValue(J);}}}e.formatText=n;function f(){if(!this._getContent()){var H=this.getEditMode();var J=this.getDataType();var K;var N=this.getId()+"-inner";switch(H){case E.Display:var O=this.getDisplayFieldHelp();if(O){if(O.showLink()){J="Link";}else if(J=="Link"){J="";}}switch(J){case"Edm.Date":case"Edm.DateTimeOffset":case"Edm.TimeOfDay":K=new T(N,{text:{path:"$field>value",type:this._getDataType()},textAlign:"{$field>textAlign}",textDirection:"{$field>textDirection}",wrapping:false});break;case"Link":K=new L(N,{text:{path:"$field>value"},href:{path:"$field>additionalValue"},textAlign:"{$field>textAlign}",textDirection:"{$field>textDirection}",press:x.bind(this)});break;default:K=new T(N,{text:"{$field>/@custom/formattedValue}",textAlign:"{$field>textAlign}",textDirection:"{$field>textDirection}",wrapping:this.getMultipleLines()});break;}break;default:switch(J){case"Edm.Date":K=r.call(this,N);break;case"Edm.DateTimeOffset":K=s.call(this,N);break;case"Edm.TimeOfDay":K=t.call(this,N);break;default:var P="$field>value";if(this.getDisplay()==sap.ui.mdc.FieldDisplay.Description){P="$field>additionalValue";}if(this.getMultipleLines()&!this.getFieldHelp()){K=new b(N,{value:{path:P},placeholder:"{$field>placeholder}",textAlign:"{$field>textAlign}",textDirection:"{$field>textDirection}",required:"{$field>required}",editable:{path:"$field>editMode",formatter:g},enabled:{path:"$field>editMode",formatter:h},valueState:"{$field>valueState}",valueStateText:"{$field>valueStateText}",width:"100%",change:v.bind(this),liveChange:w.bind(this)});}else{K=new I(N,{value:{path:P},placeholder:"{$field>placeholder}",textAlign:"{$field>textAlign}",textDirection:"{$field>textDirection}",required:"{$field>required}",editable:{path:"$field>editMode",formatter:g},enabled:{path:"$field>editMode",formatter:h},valueState:"{$field>valueState}",valueStateText:"{$field>valueStateText}",showValueHelp:!!this.getFieldHelp(),change:v.bind(this),liveChange:w.bind(this),valueHelpRequest:y.bind(this)});}break;}break;}if(K){this.setAggregation("_content",K,true);u.call(this,K);}}}e.prototype._getContent=function(){return this.getContent()||this.getAggregation("_content");};function g(H){if(H&&H==E.Editable){return true;}else{return false;}}function h(H){if(H&&H!=E.Disabled){return true;}else{return false;}}function i(H){if(H.name=="value"||H.name=="additionalValue"||H.name=="display"){var J=n(this.getValue(),this.getAdditionalValue(),this.getDisplay());this._oManagedObjectModel.setProperty("/@custom/formattedValue",J);}if(H.name=="value"||H.name=="display"){_.call(this,this.getValue());}if(H.name=="editMode"){if(H.old!=H.current){if(this.getAggregation("_content")){this.destroyAggregation("_content");f.call(this);}}}if(H.name=="multipleLines"){if(H.old!=H.current){if(this.getAggregation("_content")){this.destroyAggregation("_content");f.call(this);}}}if(H.name=="dataType"){if(H.old!=H.current){delete this._oDataType;if(this.getAggregation("_content")){this.destroyAggregation("_content");f.call(this);}}}if(H.name=="fieldHelp"&&H.child){j.call(this,H.child,H.mutation);}if(H.name=="displayFieldHelp"&&H.child){k.call(this,H.child,H.mutation);}if(H.name=="content"&&H.child){m.call(this,H.child,H.mutation);}}function j(H,J){var K=false;if(J=="remove"){H.detachEvent("select",z,this);H.detachEvent("navigate",A,this);H.detachEvent("dataUpdate",G,this);}else if(J=="insert"){H.attachEvent("select",z,this);H.attachEvent("navigate",A,this);H.attachEvent("dataUpdate",G,this);_.call(this,this.getValue());K=true;}var N=this.getAggregation("_content");if(N&&N.setShowValueHelp){N.setShowValueHelp(K);}}function k(H,J){if(J=="remove"){H.detachEvent("dataUpdate",G,this);}else if(J=="insert"){H.attachEvent("dataUpdate",G,this);}}function m(H,J){if(J=="remove"){H.unbindElement("$field");if(H.getMetadata().getEvents().change){H.detachEvent("change",v,this);}if(H.getMetadata().getEvents().liveChange){H.detachEvent("liveChange",w,this);}if(H.getMetadata().getEvents().press){H.detachEvent("press",x,this);}}else if(J=="insert"){u.call(this,H);if(H.getMetadata().getEvents().change){H.attachEvent("change",v,this);}if(H.getMetadata().getEvents().liveChange){H.attachEvent("liveChange",w,this);}if(H.getMetadata().getEvents().press){H.attachEvent("press",x,this);}if(this.getAggregation("_content")){this.destroyAggregation("_content");}}}function n(V,H,J){var K=V?V:"";var N=H?H:"";var O="";switch(J){case F.Description:O=N;break;case F.ValueDescription:O=K+" ("+N+")";break;case F.DescriptionValue:O=N+" ("+K+")";break;default:O=K;}if(O.replace){O=O.replace(" ()","");}return O;}function o(D,H){var J=new D(H,{value:{path:"$field>value",type:this._getDataType()},placeholder:"{$field>placeholder}",textAlign:"{$field>textAlign}",textDirection:"{$field>textDirection}",required:"{$field>required}",editable:{path:"$field>editMode",formatter:g},enabled:{path:"$field>editMode",formatter:h},valueState:"{$field>valueState}",valueStateText:"{$field>valueStateText}",width:"100%",change:v.bind(this)});return J;}function p(P){if(this._bIsBeingDestroyed){return;}var H=this.getAggregation("_content");if(H&&H instanceof P){return;}var J=this.getId()+"-inner";var K=o.call(this,P,J);this.setAggregation("_content",K);u.call(this,K);}function r(H){if(!D){D=sap.ui.require("sap/m/DatePicker");if(!D){sap.ui.require(["sap/m/DatePicker"],p.bind(this));return null;}}return o.call(this,D,H);}function s(H){if(!c){c=sap.ui.require("sap/m/DateTimePicker");if(!c){sap.ui.require(["sap/m/DateTimePicker"],p.bind(this));return null;}}return o.call(this,c,H);}function t(H){if(!d){d=sap.ui.require("sap/m/TimePicker");if(!d){sap.ui.require(["sap/m/TimePicker"],p.bind(this));return null;}}return o.call(this,d,H);}function u(H){H.setModel(this._oManagedObjectModel,"$field");H.bindElement({path:"/",model:"$field"});}function v(H){var V;var J=true;if("value"in H.getParameters()){V=H.getParameter("value");}else{V=this.getValue();}if("valid"in H.getParameters()){J=H.getParameter("valid");}var K=this.getFieldHelp();if(K){K.close();if(this.getDisplay()==sap.ui.mdc.FieldDisplay.Description){V=K.getKeyForText(V);K.setSelectedKey(V);this.setProperty("value",V,true);}}this.fireChange({value:V,valid:J});}function w(H){var V;var P;var J=false;if("value"in H.getParameters()){V=H.getParameter("value");}if("escPressed"in H.getParameters()){J=H.getParameter("escPressed");}if("previousValue"in H.getParameters()){P=H.getParameter("previousValue");}else{P=this.getValue();}var K=this.getFieldHelp();if(K){K.setFilterValue(V);if(this.getDisplay()==sap.ui.mdc.FieldDisplay.Description){K.setSelectedKey("");}if(K.openByTyping()){K.open();}}this.fireLiveChange({value:V,escPressed:J,previousValue:P});}function x(H){var J=this.getDisplayFieldHelp();if(J){J.open();}this.firePress();}e.prototype.getFocusDomRef=function(){var H=this._getContent();if(H){return H.getFocusDomRef();}else{return this.getDomRef();}};e.prototype.getIdForLabel=function(){var H;var J=this._getContent();if(J){H=J.getIdForLabel();}else{H=this.getId();}return H;};e.mapEdmTypes={"Edm.Boolean":"sap.ui.model.odata.type.Boolean","Edm.Byte":"sap.ui.model.odata.type.Byte","Edm.Date":"sap.ui.model.odata.type.Date","Edm.DateTime":"sap.ui.model.odata.type.DateTime","Edm.DateTimeOffset":"sap.ui.model.odata.type.DateTimeOffset","Edm.Decimal":"sap.ui.model.odata.type.Decimal","Edm.Double":"sap.ui.model.odata.type.Double","Edm.Float":"sap.ui.model.odata.type.Single","Edm.Guid":"sap.ui.model.odata.type.Guid","Edm.Int16":"sap.ui.model.odata.type.Int16","Edm.Int32":"sap.ui.model.odata.type.Int32","Edm.Int64":"sap.ui.model.odata.type.Int64","Edm.SByte":"sap.ui.model.odata.type.SByte","Edm.Single":"sap.ui.model.odata.type.Single","Edm.String":"sap.ui.model.odata.type.String","Edm.Time":"sap.ui.model.odata.type.Time","Edm.TimeOfDay":"sap.ui.model.odata.type.TimeOfDay"};e.prototype._createDataType=function(H){var O=q.sap.getObject(H);if(!O){var N=e.mapEdmTypes[H];if(!N){q.sap.log.error("Field","dataType for "+H+" can not be created!");return null;}return this._createDataType(N);}return new O(this.getDataTypeFormatOptions(),this.getDataTypeConstraints());};e.prototype._getDataType=function(H){if(!this._oDataType){this._oDataType=this.getProperty("dataType");if(typeof this._oDataType==="string"){this._oDataType=this._createDataType(this._oDataType);}}return this._oDataType;};e.prototype.enhanceAccessibilityState=function(H,J){var P=this.getParent();if(P&&P.enhanceAccessibilityState){P.enhanceAccessibilityState(this,J);}return J;};e.prototype.onsapup=function(H){var J=this.getFieldHelp();if(J){H.preventDefault();H.stopPropagation();J.navigate(-1);}};e.prototype.onsapdown=function(H){var J=this.getFieldHelp();if(J){H.preventDefault();H.stopPropagation();J.navigate(1);}};function y(H){var J=this.getFieldHelp();if(J){J.setFilterValue("");J.toggleOpen();if(this.getDisplay()==sap.ui.mdc.FieldDisplay.Description){J.setSelectedKey(this.getValue());}}}function z(H){var V=H.getParameter("value");var J=H.getParameter("additionalValue");var K=H.getParameter("key");var N;var O;if(this.getDisplay()==sap.ui.mdc.FieldDisplay.Description){N=K;O=V;}else{N=V;O=J;}this.setProperty("value",N);this.setAdditionalValue(O);this.fireChange({value:N,valid:true});}function A(H){var V=H.getParameter("value");var K=H.getParameter("key");var N;if(this.getDisplay()==sap.ui.mdc.FieldDisplay.Description){N=K;}else{N=V;}var J=this.getAggregation("_content");if(J&&J.setDOMValue){J.setDOMValue(V);J._doSelect();}this.fireLiveChange({value:N});}function G(H){if(this.getEditMode()==E.Display){if(this.getAggregation("_content")){this.destroyAggregation("_content");}}else{_.call(this,this.getValue());}}return e;},true);
